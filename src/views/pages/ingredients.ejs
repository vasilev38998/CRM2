<%- include('../partials/header', { title: 'Ингредиенты' }) %>
<h2>Ингредиенты и закупки</h2>
<% if (error) { %><div class="error"><%= error %></div><% } %>

<h3>Добавить ингредиент</h3>
<form action="/ingredients" method="post">
  <label>Название</label>
  <input name="name" required />
  <label>Единица (г/мл)</label>
  <input name="unit" required />
  <button type="submit">Добавить</button>
</form>

<h3>Закупка</h3>
<form action="/ingredients/purchase" method="post">
  <label>Ингредиент</label>
  <select name="ingredient_id">
    <% ingredients.forEach(ingredient => { %>
      <option value="<%= ingredient.id %>"><%= ingredient.name %></option>
    <% }) %>
  </select>
  <label>Количество</label>
  <input name="quantity" type="number" step="0.0001" required />
  <label>Сумма, ₽</label>
  <input name="total_cost" type="number" step="0.01" required />
  <label>Дата</label>
  <input name="purchased_at" type="date" required />
  <button type="submit">Добавить закупку</button>
</form>

<h3>CSV импорт закупок</h3>
<p><a href="/ingredients/template">Скачать шаблон CSV</a></p>
<form action="/ingredients/import" method="post" enctype="multipart/form-data">
  <input type="file" name="file" accept=".csv" required />
  <button type="submit">Загрузить CSV</button>
</form>

<h3>Список ингредиентов</h3>
<table class="table">
  <thead>
    <tr>
      <th>Название</th>
      <th>Единица</th>
      <th>Средневзвешенная себестоимость</th>
    </tr>
  </thead>
  <tbody>
    <% ingredients.forEach(ingredient => { %>
      <tr>
        <td><%= ingredient.name %></td>
        <td><%= ingredient.unit %></td>
        <td><%= Number(ingredient.avg_cost_per_unit).toFixed(4) %> ₽</td>
      </tr>
    <% }) %>
  </tbody>
</table>

<h3>Закупки</h3>
<table class="table">
  <thead>
    <tr>
      <th>Ингредиент</th>
      <th>Количество</th>
      <th>Сумма</th>
      <th>Дата</th>
    </tr>
  </thead>
  <tbody>
    <% purchases.forEach(purchase => { %>
      <tr>
        <td><%= purchase.ingredient_name %></td>
        <td><%= purchase.quantity %></td>
        <td><%= purchase.total_cost %> ₽</td>
        <td><%= new Date(purchase.purchased_at).toLocaleDateString('ru-RU') %></td>
      </tr>
    <% }) %>
  </tbody>
</table>
<%- include('../partials/footer') %>
